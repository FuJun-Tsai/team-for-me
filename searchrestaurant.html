<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- other -->
    <link rel="stylesheet" href="./sass/vender/other/hover-min.css">
    <!-- <link rel="stylesheet" href="./css/other/animation.css"> -->
    <!-- H&F -->
    <!-- <link rel="stylesheet" href="./css/head_footer_style.css"> -->
    <!-- kits -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="./css/bootstrap.css">
    <!-- <link rel="stylesheet" href="./css/btn_hover.css"> -->
    <!-- <link rel="stylesheet" href="./css/bootstrap-grid.css"> -->

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.min.js"></script>

    <script src="./js/btn_hover.js"></script>
    <script src="./js/bootstrap.js"></script>
    <script src="./js/header_fixed.js"></script>
    <!-- <link rel="stylesheet" href="./css/background.css"> -->
    <!-- local -->
    <link rel="stylesheet" href="./css/allstyle.css">
    <!-- <link rel="stylesheet" href="./css/bootstrap/bootstrap_nopm.css"> -->
    <!-- btn -->
    <link rel="stylesheet" href="./css/btn_hover.css">
    <script src="js/btn_hover.js"></script>

    <title>Document</title>
</head>

<body>
    <!-- 登入lightbox -->
    <section class="section_res" id="login_box" style="display:none">
        <div class="container_res">
            <div class="user singinBx">
                <div class="img_res">
                    <img src="./image/2.png" alt="">
                </div>
                <div class="form_res">
                    <form name="login">
                        <h2>會員登入</h2>
                        <input type="text" name="MEMBER_ID" placeholder="請輸入帳號">
                        <input type="password" name="MEMBER_PSW" placeholder="請輸入密碼">

                        <input type="button" name="" value="登入" id="btnLogin">
                        <input type="button" name="" value="取消" id="btnLoginCancel">
                        <p class="learn">還未成為會員?<br><a href="#" onclick="toggleForm();">註冊會員請點我</a></p>
                    </form>
                </div>
            </div>
            <div class="user singupBx">
                <div class="form_res">
                    <form action="signup.php" method="post">
                        <h2>註冊</h2>
                        <input type="text" name="newmem_account" placeholder="請輸入註冊email">
                        <input type="password" name="newmem_psw" placeholder="請輸入密碼">
                        <!-- <input type="password" name="password" placeholder="再次確認密碼"> -->
                        <input type="submit" name="submit" value="註冊">
                        <p class="learn">已經有會員了?<br><a href="#" onclick="toggleForm();">會員登入點我點我</a></p>
                    </form>
                </div>
                <div class="img_res">
                    <img src="./image/4.jpg" alt="">
                </div>
            </div>
        </div>
    </section>
    <!-- 背景泡泡 -->
    <div id="bubbles">
        <div class="bubble x1"></div>
        <div class="bubble x2"></div>
        <div class="bubble x3"></div>
        <div class="bubble x4"></div>
        <div class="bubble x5"></div>
        <div class="bubble x6"></div>
        <div class="bubble x7"></div>
        <div class="bubble x8"></div>
        <div class="bubble x9"></div>
    </div>
    <header>
        <section>
            <div class="logo">
                <a href="./index.html">
                    <img src="./image/logoHeader.svg" alt="">
                </a>
            </div>
            <div class="nav">
                <ul>
                    <li class="hvr-pulse-grow">
                        <a href="./game.html"> 吃吃配對</a>
                    </li>
                    <li class="hvr-pulse-grow">
                        <a href="./searchrestaurant.html">餐廳介紹</a>
                    </li>
                    <li class="hvr-pulse-grow">
                        <a href="./share.html">吃貨分享</a>
                    </li>
                    <li class="hvr-pulse-grow">
                        <a href="./about_us.html">關於我們</a>
                    </li>
                    <li>
                        <a href="./open_group.html" class="hvr-pulse-grow"><button style="padding: 10px 20px;">揪團去!</button></a>
                    </li>
                </ul>
            </div>
            <div class="member" id="login">
                <div class="icon" >
                    <img src="./image/icon.svg" id="headshot_icon">
                    <span class="username" style="display: none;"></span>
                </div>
                <div id="nametest"></div>
                <!-- <span id="memName">&nbsp;</span> -->
                <span id="spanLogin">登入</span>
            </div>
            <div id="menu-bar">
                <div id="menu" onclick="onClickMenu()">
                    <div id="bar1" class="bar"></div>
                    <div id="bar2" class="bar"></div>
                    <div id="bar3" class="bar"></div>
                </div>
                <ul class="nav1" id="nav1">
                    <div class="member">
                        <div class="icon">
                            <a href="./login.html">
                                <img src="./image/icon.svg" alt="">
                            </a>
                        </div>
                        <a href="./login.html" class="hvr-pulse-grow"><span style="color: black;">登入</span></a>
                    </div>
                    <li>
                        <a href="./game.html">吃吃配對</a>
                    </li>
                    <li>
                        <a href="./searchrestaurant.html">餐廳介紹</a>
                    </li>
                    <li>
                        <a href="./share.html"> 吃貨分享</a>
                    </li>
                    <li>
                        <a href="./about_us.html">關於我們</a>
                    </li>
                    <li>
                        <a href="./open_group.html" class="hvr-pulse-grow"><button>揪團去!</button></a>
                    </li>
                </ul>
            </div>
            <div class="menu-bg" id="menu-bg"></div>
        </section>
    </header>

    <!-- ***************************** -->

    <section>
        <div class="banner_rest_sear">
            <div class="banner_bg">
                <div class="txt">
                    <h1>　　餐　廳　介　紹　　</h1>
                </div>
            </div>    
        </div>

        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="selection col-lg-8" id="condition" method="POST" action="searchConditionRender.php">

                        <input id="searchword" type="text" placeholder="美食快搜" name="searchbar">
                        <button id="searchwordbtn" value="" name="condition">搜尋</button>

                        <label for="kind" class="kind">餐廳種類：
                            <label for="k1"><input type="checkbox" name="kind" id="k1" value="1">日式</label>
                            <label for="k2"><input type="checkbox" name="kind" id="k2" value="2">美式</label>
                            <label for="k3"><input type="checkbox" name="kind" id="k3" value="3">西式</label>
                            <label for="k4"><input type="checkbox" name="kind" id="k4" value="4">韓式</label>
                            <label for="k5"><input type="checkbox" name="kind" id="k5" value="5">中台</label>
                        </label>

                        <label for="style[]" class="style">料理風格：
                            <label for="s1"><input type="checkbox" name="style[]" id="s1" value="1">火鍋</label>
                            <label for="s2"><input type="checkbox" name="style[]" id="s2" value="2">燒烤</label>
                            <label for="s3"><input type="checkbox" name="style[]" id="s3" value="3">炸物</label>
                            <label for="s4"><input type="checkbox" name="style[]" id="s4" value="4">快炒</label>
                            <label for="s5"><input type="checkbox" name="style[]" id="s5" value="5">簡餐</label>
                            <label for="s6"><input type="checkbox" name="style[]" id="s6" value="6">排餐</label>
                        </label>

                    </div>
                </div>
            </div>
            
            <div class="container">
                <div class="row">
                    <div class="error">似乎沒有匹配篩選的店家...換其他的搜尋條件吧~</div>
                </div>
            </div>

            <div class="result">

                <!-- <div id="R1" class="rest container">
                    <div class="row">
                        <div class="rep col-lg-5">
                            <img src="./image/restaurant_management_img/牛篷牛排_1.jpg" alt="">
                        </div>
                        <div class="detail col-lg-7">
                            <h2>牛篷牛排店</h2>
                            <div class="kind west"></div>
                            <div class="style steak"></div>
                            <div class="record">
                                <div class="like"><i class="fas fa-heart"></i><span>23</span></div>
                                <div class="mess"><i class="far fa-comment-dots"></i><span>45</span></div>
                                <div class="group"><i class="fas fa-users"></i><span>300</span></div>
                            </div>
                            <h3>餐廳介紹：</h3>
                            <p id="rint">三月了，氣溫逐漸回升，儘管台北不是一個擅於開花的城市，卻也能嗅見春天的味道。春天來臨，就想著出遊踏青，然而不想跑得太遠，就從台北市裡挑選一間充滿綠意的小天地吧，Purrson Bistro 呼嚕小酒館，座落於木柵的小山坡，彷彿走進城市裡的森林。</p>
                            <h3>網友留言：</h3>
                            <div id="leavemessage" class="insearch">
                                <div id="L1" class="L">
                                    <img src="http://fakeimg.pl/60x60" alt="">
                                    <p>1231232313</p>
                                </div>
                                <div id="L2" class="L">
                                    <img src="http://fakeimg.pl/60x60" alt="">
                                    <p>1231232313</p>
                                </div>
                                <div id="L3" class="L">
                                    <img src="http://fakeimg.pl/60x60" alt="">
                                    <p>1231232313</p>
                                </div>
                                <div id="L4" class="L">
                                    <img src="http://fakeimg.pl/60x60" alt="">
                                    <p>1231232313</p>
                                </div>
                            </div>
                            <form action="singlerestaurant.html" method="GET">
                                <button name="RES_NO" value="1" class="btnsingle btn_10 btn_js">詳細<span></span></button>
                            </form>
                            <div class="go">
                                <a href="./open_group.html"><button class="btnRed btn_3 btn_js">開團<span></span></button></a>
                                <a href=""><button class="btnBlue btn_4 btn_js">參團<span></span></button></a>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>

            <ul class="page">

            </ul>
        </div>

    </section>

    <!-- ***************************** -->
    <footer>
        <div class="footer">
            <h6>Copyright © 2020 食緣 All Rights Reserved</h6>
        </div>
    </footer>

    <!--hambuger-->
    <script>
        function onClickMenu() {
            document.getElementById("menu").classList.toggle("change");
            document.getElementById("nav1").classList.toggle("change");
            document.getElementById("menu-bg").classList.toggle("change-bg");
        }

        function onClickSubMenu() {
            document.getElementById("sub_menu").classList.toggle("change1");
            document.querySelector(".nav1>li:nth-child(1)").classList.toggle("none");
            document.querySelector(".nav1>li:nth-child(3)").classList.toggle("none");
            document.querySelector(".nav1>li:nth-child(4)").classList.toggle("none");
            document.querySelector(".nav1>li:nth-child(5)").classList.toggle("none");
        }
    </script>

    <script>

        $(document).ready(function(){
            searchJS();
        });

        function searchJS(){

            $('.result').empty();

            K = '';
            S = [];
            result = [];
            search = '';
            ConditionSearch(K,S.join(','),result,search);
            // MessageRender(result);

            function MessageRender(e){
                $.ajax({
                    url:'searchRenderLM.php',
                    type:'POST',
                    dataType:'json',
                    data:{
                        e:e.join(','),
                    },
                    success(data){
                        console.log(data);
                        for(let i=0 ; i<=data.length-1 ;i+=1){
                            $(`.${data[i].resno}`).append(`
                                <div id="${data[i].id}" class="L">
                                    <img src="./image/member/${data[i].mmimg}" alt="">
                                    <p>${data[i].content}</p>
                                </div>
                            `);
                        };
                    },
                    
                });
                imgcube();
                
            }

            $('#condition input:checkbox').on('click',function(){
                if($(this).attr('name')=='kind'){
                    K = $("input[name='kind']:checked").map(function(){
                        return $(this).val();
                    }).get();
                }else{
                    S = $("input[name='style[]']:checked").map(function(){
                        return $(this).val(); 
                    }).get();
                }
                
                ConditionSearch(K,S.join(','),search);
            });


            $('#searchwordbtn').on('click',function(){
                $(this).val(`${$('#searchword').val()}`);
                search = $('#searchword').val();
                console.log(search);
                console.log($('#searchword').val());
                // console.log(K);
                // console.log(S);

                ConditionSearch(K,S.join(','),search);
                return false;
            });


            function ConditionSearch(K,S,result,search=''){
                let condition = `${K}&${S}`;
                // console.log("----????????---",search); 
                $.ajax({
                    url:'searchConditionRender.php',
                    type:'GET',
                    dataType:'json',
                    data:{
                        condition:condition,
                        search:search
                    },
                    success(data){
                        console.log(data);
                        result = [];
                        for(let i=0;i<data.length;i+=1){
                            result.push(data[i].no);
                            if(data[i].collectRES == null){
                                data[i].collectRES = 'style="color:black;"';
                            }else{
                                data[i].collectRES = 'style="color:red;"';
                            }
                        };
                        $('.error').css({'display': 'none'});
                        $('.result').empty();
                        for(let i=0;i<data.length;i+=1){
                            $('.result').append(`
                                <div id="${data[i].id}" class="rest container">
                                    <div class="row">
                                        <div class="rep col-lg-5">
                                            <img src="./image/restaurant_management_img/${data[i].img1}" alt="">
                                        </div>
                                        <div class="detail col-lg-7">
                                            <h2>${data[i].name}</h2>
                                            <div class="kind west">${data[i].kind}</div>
                                            <div class="style steak">${data[i].style}</div>
                                            <div class="record">
                                                <div class="like"><i class="far fa-heart"></i><span>23</span></div>
                                                <div class="mess"><i class="far fa-comment-dots"></i><span>45</span></div>
                                                <div class="group"><i class="fas fa-users"></i><span>300</span></div>
                                            </div>
                                            <h3>餐廳介紹：</h3>
                                            <p id="rint">${data[i].summary}</p>
                                            <h3>網友留言：</h3>
                                            <div id="leavemessage" class="insearch ${data[i].id}">

                                            </div>
                                            <form action="singlerestaurant.html" method="GET">
                                                <button name="RES_NO" value="${data[i].no}" class="btnsingle btn_10 btn_js">詳細<span></span></button>
                                            </form>
                                            <div class="go">
                                                <a href="./open_group.html"><button class="btnRed btn_3 btn_js">開團<span></span></button></a>
                                                <a href=""><button class="btnBlue btn_4 btn_js">參團<span></span></button></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `);

                            TweenLite.from(`#${data[i].id}`,0.5,{
                                opacity:-2,
                                y:-300,
                            },);

                        };
                        
                    },
                    error(data){
                        $('.result').empty();
                        $('.error').css({'display': 'block'});

                    },
                    complete(){
                        MessageRender(result);
                        collection();
                    },

                });

            };

            function collection(){
                $.ajax({
                    url:'REScollection.php',
                    type:'POST',
                    dataType:'json',
                    success(data){
                        console.log(data); 
                        for(let i=0;i<=data.length-1;i+=1){
                            $(`#${data[i].ID} .like i`).addClass('tored');
                        }
                    },
                    complete(){
                        $('.like').on('click',function(){
                            if($('#spanLogin').text()=='登入'){
                                $('#login_box').css({'display':'flex'});
                            }else{
                                let RES = ($(this).closest('.rest').attr('id').split('R')[1]);
                                $(this).children('.like i').toggleClass('tored');
                                collect($(this).children('.like i').hasClass('tored'),RES);
                            }
                        }); 
                    }
                });

            }

            function collect(e,RES){
                $.ajax({
                    url:'collect.php',
                    type:'POST',
                    dataType:'json',
                    data:{
                        do:e,
                        RES:RES,
                    },
                    success(e){
                        
                    },
                
                });
            }
     
        }
  
        ///////////////

        function imgcube(){
            let imgwidth = $('.rep img').width();
            if($(window).width()<600){
                $('.rep img').width($(window).width()-20);
                $('.rep img').height($(window).width()-20);
            }else{
                $('.rep img').height(500);
            }
        };

        window.addEventListener('resize',function(){
                imgcube();
        });

        $('.kind input').on('click',function(){
            if($(this).prop('checked')){
                $('.kind input:checkbox').prop('checked',false);
                $(this).prop('checked',true);
            };
        });

    </script>

    <script src="js/login.js"></script>
    <!-- <script src="./js/searchrestaurant.js"></script> -->
    <!-- <script src="./js/searchAnimate.js"></script> -->

</body>

</html>